{"ast":null,"code":"// src/components/Contributions.tsx - VERSION CONNECTÉE À L'API DJANGO\nimport React,{useState,useEffect,useMemo}from'react';import{useAuth}from'../context/AuthContext';import{useNavigate}from'react-router-dom';// --- INTERFACES ADAPTÉES À L'API DJANGO ---\n// Interface pour le formulaire\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MINIMUM_CONTRIBUTION=4000;const CONTRIBUTION_DUE_DAY=25;const LATE_FEE_PER_DAY=200;const BONUS_THRESHOLD=6800;// 4000 + 70% de 4000\nconst API_BASE_URL=process.env.REACT_APP_API_BASE_URL||'http://127.0.0.1:8000/api';// --- COMPOSANT PRINCIPAL ---\nconst Contributions=()=>{const{user,hasPermission,getRoleDisplayName}=useAuth();const navigate=useNavigate();// --- ÉTATS ---\nconst[contributions,setContributions]=useState([]);const[members,setMembers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[filteredContributions,setFilteredContributions]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[filterStatus,setFilterStatus]=useState('All');const[isModalOpen,setIsModalOpen]=useState(false);const[isSubmitting,setIsSubmitting]=useState(false);const initialFormState={member:0,amount:MINIMUM_CONTRIBUTION,date:new Date().toISOString().split('T')[0]};const[currentContribution,setCurrentContribution]=useState(initialFormState);const[editingContribution,setEditingContribution]=useState(null);const[formErrors,setFormErrors]=useState({});// --- FONCTIONS API ---\nconst fetchContributions=async()=>{try{setLoading(true);setError(null);const response=await fetch(`${API_BASE_URL}/contributions/`,{headers:{'Authorization':`Bearer ${user===null||user===void 0?void 0:user.token}`,'Content-Type':'application/json'}});if(!response.ok){throw new Error(`Erreur HTTP: ${response.status}`);}const data=await response.json();setContributions(data);}catch(err){setError(err instanceof Error?err.message:'Erreur lors du chargement des contributions');console.error('Erreur lors du chargement des contributions:',err);}finally{setLoading(false);}};const fetchMembers=async()=>{try{const response=await fetch(`${API_BASE_URL}/members/`,{headers:{'Authorization':`Bearer ${user===null||user===void 0?void 0:user.token}`,'Content-Type':'application/json'}});if(!response.ok){throw new Error(`Erreur HTTP: ${response.status}`);}const data=await response.json();setMembers(data);}catch(err){console.error('Erreur lors du chargement des membres:',err);}};// Charger les données au montage du composant\nuseEffect(()=>{if(user!==null&&user!==void 0&&user.token){fetchContributions();fetchMembers();}},[user===null||user===void 0?void 0:user.token]);// --- FILTRAGE DES CONTRIBUTIONS ---\nuseEffect(()=>{let currentData=contributions;if(searchTerm){currentData=currentData.filter(c=>{const member=members.find(m=>m.id===c.member);const memberName=member?`${member.user.first_name} ${member.user.last_name}`:'';return memberName.toLowerCase().includes(searchTerm.toLowerCase())||c.id.toString().includes(searchTerm.toLowerCase());});}if(filterStatus!=='All'){currentData=currentData.filter(c=>{if(filterStatus==='En retard')return c.is_late;if(filterStatus==='À temps')return!c.is_late;return true;});}setFilteredContributions(currentData);},[searchTerm,filterStatus,contributions,members]);// --- CALCULS MEMOIZÉS ---\nconst stats=useMemo(()=>({totalContributions:contributions.length,totalLate:contributions.filter(c=>c.is_late).length,currentMonthTotal:contributions.filter(c=>{const cDate=new Date(c.date);const today=new Date();return cDate.getMonth()===today.getMonth()&&cDate.getFullYear()===today.getFullYear();}).reduce((sum,c)=>sum+c.amount,0),totalAmount:contributions.reduce((sum,c)=>sum+c.amount,0)}),[contributions]);const selectedMemberInModal=useMemo(()=>{return members.find(m=>m.id===currentContribution.member);},[currentContribution.member,members]);// --- FONCTIONS UTILITAIRES ---\nconst calculateContributionImpact=(amount,date)=>{const contributionDate=new Date(date);const dayOfMonth=contributionDate.getDate();const isLate=dayOfMonth>CONTRIBUTION_DUE_DAY;const hasBonus70=amount>=BONUS_THRESHOLD;let pointsChange=0;let penalties=0;if(isLate){pointsChange-=15;// Pénalité retard selon la charte\nconst daysLate=dayOfMonth-CONTRIBUTION_DUE_DAY;penalties=daysLate*LATE_FEE_PER_DAY;}else{pointsChange+=5;// Points base pour contribution à temps\n}if(hasBonus70){pointsChange+=5;// Bonus 70%\n}return{pointsChange,penalties,isLate,hasBonus70};};// --- GESTIONNAIRES D'ÉVÉNEMENTS ---\nconst handleOpenModalForAdd=()=>{if(!hasPermission('add_contributions')&&!hasPermission('manage_contributions')){alert(\"Vous n'avez pas la permission d'ajouter des contributions.\");return;}setEditingContribution(null);setCurrentContribution(initialFormState);setFormErrors({});setIsModalOpen(true);};const handleOpenModalForEdit=contribution=>{if(!hasPermission('edit_contributions')&&!hasPermission('manage_contributions')){alert(\"Vous n'avez pas la permission de modifier les contributions.\");return;}setEditingContribution(contribution);setCurrentContribution({member:contribution.member,amount:contribution.amount,date:contribution.date});setFormErrors({});setIsModalOpen(true);};const handleDelete=async id=>{if(!hasPermission('manage_contributions')){alert(\"Vous n'avez pas la permission de supprimer des contributions.\");return;}if(!window.confirm('Êtes-vous sûr de vouloir supprimer cette contribution ?')){return;}try{const response=await fetch(`${API_BASE_URL}/contributions/${id}/`,{method:'DELETE',headers:{'Authorization':`Bearer ${user===null||user===void 0?void 0:user.token}`,'Content-Type':'application/json'}});if(response.status===404){throw new Error('Contribution non trouvée. Elle a peut-être déjà été supprimée.');}if(response.status===403){throw new Error('Accès refusé. Vérifiez vos permissions.');}if(response.status===405){throw new Error('Méthode DELETE non autorisée sur cet endpoint.');}if(!response.ok){const errorData=await response.json().catch(()=>null);throw new Error((errorData===null||errorData===void 0?void 0:errorData.detail)||(errorData===null||errorData===void 0?void 0:errorData.error)||`Erreur HTTP ${response.status}: ${response.statusText}`);}await fetchContributions();alert('Contribution supprimée avec succès');}catch(err){const errorMessage=err instanceof Error?err.message:'Erreur lors de la suppression';setError(errorMessage);alert(`Erreur: ${errorMessage}`);console.error('Erreur lors de la suppression:',err);}};const handleSave=async()=>{// Validation\nif(!currentContribution.member||!currentContribution.amount){setFormErrors({general:'Veuillez sélectionner un membre et saisir un montant valide.'});return;}if(currentContribution.amount<MINIMUM_CONTRIBUTION){setFormErrors({amount:`Le montant minimal est de ${MINIMUM_CONTRIBUTION.toLocaleString()} XAF.`});return;}setIsSubmitting(true);setFormErrors({});try{const method=editingContribution?'PUT':'POST';const url=editingContribution?`${API_BASE_URL}/contributions/${editingContribution.id}/`:`${API_BASE_URL}/contributions/`;const response=await fetch(url,{method,headers:{'Authorization':`Bearer ${user===null||user===void 0?void 0:user.token}`,'Content-Type':'application/json'},body:JSON.stringify(currentContribution)});if(!response.ok){const errorData=await response.json();throw new Error(errorData.error||`Erreur lors de ${editingContribution?'la modification':'la création'}`);}await fetchContributions();setIsModalOpen(false);if(editingContribution){alert('Contribution modifiée avec succès !');}else{alert('Contribution ajoutée avec succès !');}}catch(err){setFormErrors({general:err instanceof Error?err.message:'Erreur lors de la sauvegarde'});console.error('Erreur lors de la sauvegarde:',err);}finally{setIsSubmitting(false);}};const closeModal=()=>{setIsModalOpen(false);setEditingContribution(null);setFormErrors({});setIsSubmitting(false);};// --- PERMISSIONS D'AFFICHAGE ---\nconst canViewStats=hasPermission('view_reports')||hasPermission('manage_contributions');const canAddContributions=hasPermission('add_contributions')||hasPermission('manage_contributions');const canEditContributions=hasPermission('edit_contributions')||hasPermission('manage_contributions');const canDeleteContributions=hasPermission('manage_contributions');// --- VÉRIFICATION DES PERMISSIONS ---\nif(!hasPermission('view_contributions')){return/*#__PURE__*/_jsx(\"div\",{style:styles.page,children:/*#__PURE__*/_jsxs(\"div\",{style:styles.errorContainer,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Acc\\xE8s refus\\xE9\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Vous n'avez pas la permission de consulter les contributions.\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Votre r\\xF4le actuel : \",/*#__PURE__*/_jsx(\"strong\",{children:user!==null&&user!==void 0&&user.role?getRoleDisplayName(user.role):'Non défini'})]})]})});}// --- AFFICHAGE DE L'ERREUR ---\nif(error&&!loading){return/*#__PURE__*/_jsx(\"div\",{style:styles.page,children:/*#__PURE__*/_jsxs(\"div\",{style:styles.errorContainer,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Erreur de chargement\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:fetchContributions,style:styles.button,children:\"R\\xE9essayer\"})]})});}// Calcul de l'impact pour l'aperçu\nconst impact=currentContribution.amount>=MINIMUM_CONTRIBUTION&&currentContribution.date?calculateContributionImpact(currentContribution.amount,currentContribution.date):null;// --- RENDU PRINCIPAL ---\nreturn/*#__PURE__*/_jsxs(\"div\",{style:styles.page,children:[/*#__PURE__*/_jsxs(\"header\",{style:styles.header,children:[/*#__PURE__*/_jsxs(\"h2\",{style:styles.headerTitle,children:[\"Gestion des Contributions\",loading&&/*#__PURE__*/_jsx(\"span\",{style:styles.loadingText,children:\" (Chargement...)\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),style:styles.backButton,children:\"\\u2190 Retour au Tableau de bord\"})]}),canViewStats&&/*#__PURE__*/_jsxs(\"section\",{style:styles.statSection,children:[/*#__PURE__*/_jsx(StatCard,{title:\"Total ce mois\",value:`${stats.currentMonthTotal.toLocaleString()} XAF`}),/*#__PURE__*/_jsx(StatCard,{title:\"Total contributions\",value:stats.totalContributions.toString()}),/*#__PURE__*/_jsx(StatCard,{title:\"Contributions en retard\",value:stats.totalLate.toString()}),/*#__PURE__*/_jsx(StatCard,{title:\"Montant total\",value:`${stats.totalAmount.toLocaleString()} XAF`})]}),/*#__PURE__*/_jsxs(\"section\",{style:styles.controlsSection,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Rechercher par nom, ID...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),style:styles.searchInput}),/*#__PURE__*/_jsxs(\"select\",{value:filterStatus,onChange:e=>setFilterStatus(e.target.value),style:styles.filterSelect,children:[/*#__PURE__*/_jsx(\"option\",{value:\"All\",children:\"Tous les statuts\"}),/*#__PURE__*/_jsx(\"option\",{value:\"\\xC0 temps\",children:\"\\xC0 temps\"}),/*#__PURE__*/_jsx(\"option\",{value:\"En retard\",children:\"En retard\"})]}),canAddContributions&&/*#__PURE__*/_jsx(\"button\",{onClick:handleOpenModalForAdd,style:styles.addButton,children:\"+ Ajouter une Cotisation\"})]}),loading?/*#__PURE__*/_jsx(\"div\",{style:styles.loadingContainer,children:/*#__PURE__*/_jsx(\"p\",{children:\"Chargement des contributions...\"})}):filteredContributions.length===0?/*#__PURE__*/_jsxs(\"div\",{style:styles.emptyState,children:[/*#__PURE__*/_jsx(\"p\",{children:\"Aucune contribution trouv\\xE9e.\"}),contributions.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"Commencez par ajouter votre premi\\xE8re contribution !\"})]}):/*#__PURE__*/_jsx(\"div\",{style:styles.tableContainer,children:/*#__PURE__*/_jsxs(\"table\",{style:styles.table,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Membre\"}),/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Montant\"}),/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Statut\"}),canViewStats&&/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Points Berry\"}),(canEditContributions||canDeleteContributions)&&/*#__PURE__*/_jsx(\"th\",{style:styles.th,children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredContributions.map(c=>{const member=members.find(m=>m.id===c.member);const memberName=member?`${member.user.first_name} ${member.user.last_name}`:'Membre inconnu';return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:styles.td,children:c.id}),/*#__PURE__*/_jsx(\"td\",{style:styles.td,children:memberName}),/*#__PURE__*/_jsxs(\"td\",{style:styles.td,children:[c.amount.toLocaleString(),\" XAF\"]}),/*#__PURE__*/_jsx(\"td\",{style:styles.td,children:new Date(c.date).toLocaleDateString('fr-FR')}),/*#__PURE__*/_jsx(\"td\",{style:styles.td,children:/*#__PURE__*/_jsx(StatusChip,{status:c.is_late?'En retard':'À temps'})}),canViewStats&&/*#__PURE__*/_jsx(\"td\",{style:styles.td,children:/*#__PURE__*/_jsxs(\"span\",{style:{color:c.points_berry>0?'#22c55e':'#ef4444',fontWeight:'bold'},children:[c.points_berry>0?`+${c.points_berry}`:c.points_berry,\" pts\"]})}),(canEditContributions||canDeleteContributions)&&/*#__PURE__*/_jsxs(\"td\",{style:{...styles.td,display:'flex',gap:'8px'},children:[canEditContributions&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleOpenModalForEdit(c),style:styles.actionButtonEdit,children:\"Modifier\"}),canDeleteContributions&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(c.id),style:styles.actionButtonDelete,children:\"Supprimer\"})]})]},c.id);})})]})}),!canAddContributions&&!canEditContributions&&/*#__PURE__*/_jsx(\"div\",{style:styles.permissionInfo,children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Information :\"}),\" En tant que \",user!==null&&user!==void 0&&user.role?getRoleDisplayName(user.role):'membre',\", vous pouvez consulter les contributions mais pas les modifier. Contactez le Tr\\xE9sorier pour toute modification.\"]})}),isModalOpen&&/*#__PURE__*/_jsx(\"div\",{style:styles.modalOverlay,children:/*#__PURE__*/_jsxs(\"div\",{style:styles.modalContent,children:[/*#__PURE__*/_jsx(\"h3\",{style:styles.modalTitle,children:editingContribution?'Modifier la Contribution':'Ajouter une Contribution'}),formErrors.general&&/*#__PURE__*/_jsx(\"p\",{style:styles.formError,children:formErrors.general}),/*#__PURE__*/_jsxs(\"div\",{style:styles.modalForm,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:styles.modalLabel,children:\"Membre\"}),/*#__PURE__*/_jsxs(\"select\",{style:styles.modalInput,value:currentContribution.member,onChange:e=>setCurrentContribution({...currentContribution,member:parseInt(e.target.value)}),disabled:isSubmitting,children:[/*#__PURE__*/_jsx(\"option\",{value:0,disabled:true,children:\"S\\xE9lectionner un membre...\"}),members.map(m=>/*#__PURE__*/_jsxs(\"option\",{value:m.id,children:[m.user.first_name,\" \",m.user.last_name]},m.id))]}),selectedMemberInModal&&/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'12px',color:'#1e3a8a',marginTop:'4px'},children:[\"Solde actuel: \",selectedMemberInModal.berry_score,\" points Berry\"]}),formErrors.member&&/*#__PURE__*/_jsx(\"p\",{style:styles.errorMessage,children:formErrors.member})]}),/*#__PURE__*/_jsx(ModalInput,{label:`Montant (XAF) - Minimum: ${MINIMUM_CONTRIBUTION.toLocaleString()}`,type:\"number\",value:currentContribution.amount,onChange:e=>setCurrentContribution({...currentContribution,amount:parseFloat(e.target.value)||0}),error:formErrors.amount,disabled:isSubmitting}),/*#__PURE__*/_jsx(ModalInput,{label:\"Date\",type:\"date\",value:currentContribution.date,onChange:e=>setCurrentContribution({...currentContribution,date:e.target.value}),error:formErrors.date,disabled:isSubmitting}),impact&&/*#__PURE__*/_jsxs(\"div\",{style:styles.impactPreview,children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Aper\\xE7u de l'impact (selon la charte) :\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[!impact.isLate&&/*#__PURE__*/_jsx(\"li\",{style:{color:'#22c55e'},children:\"Points Berry de base : +5 points (contribution \\xE0 temps)\"}),impact.hasBonus70&&/*#__PURE__*/_jsxs(\"li\",{style:{color:'#22c55e'},children:[\"Bonus 70% : +5 points (montant \",'>',\"= \",BONUS_THRESHOLD.toLocaleString(),\" XAF)\"]}),impact.isLate&&/*#__PURE__*/_jsxs(\"li\",{style:{color:'#ef4444'},children:[\"Retard : -15 points Berry\",impact.penalties>0&&` + ${impact.penalties.toLocaleString()} XAF d'amende`]}),/*#__PURE__*/_jsxs(\"li\",{style:{color:impact.pointsChange>0?'#22c55e':'#ef4444',fontWeight:'bold'},children:[\"Total impact : \",impact.pointsChange>0?'+':'',impact.pointsChange,\" points Berry\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:styles.modalActions,children:[/*#__PURE__*/_jsx(\"button\",{onClick:closeModal,style:styles.modalButtonCancel,disabled:isSubmitting,children:\"Annuler\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,style:styles.modalButtonSave,disabled:isSubmitting,children:isSubmitting?editingContribution?'Modification...':'Ajout...':editingContribution?'Enregistrer':'Ajouter'})]})]})})]});};// --- COMPOSANTS D'ASSISTANCE ---\nconst ModalInput=_ref=>{let{label,error,...props}=_ref;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:styles.modalLabel,children:label}),/*#__PURE__*/_jsx(\"input\",{style:{...styles.modalInput,...(error&&styles.inputError)},...props}),error&&/*#__PURE__*/_jsx(\"p\",{style:styles.errorMessage,children:error})]});};const StatCard=_ref2=>{let{title,value}=_ref2;return/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'white',padding:'20px',borderRadius:'8px',boxShadow:'0 4px 6px rgba(0,0,0,0.1)',flex:'1 1 250px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:0,color:'#4b5563',fontSize:'16px',fontWeight:'600'},children:title}),/*#__PURE__*/_jsx(\"p\",{style:{margin:'8px 0 0 0',color:'#1e3a8a',fontSize:'28px',fontWeight:'bold'},children:value})]});};const StatusChip=_ref3=>{let{status}=_ref3;const chipStyle={padding:'4px 12px',borderRadius:'9999px',fontWeight:'600',fontSize:'12px',color:'white',backgroundColor:status==='À temps'?'#22c55e':'#ef4444'};return/*#__PURE__*/_jsx(\"span\",{style:chipStyle,children:status});};// --- STYLES ---\nconst styles={page:{fontFamily:'Arial, sans-serif',padding:'24px',backgroundColor:'#f3f4f6',minHeight:'100vh'},header:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'32px',flexWrap:'wrap',gap:'16px'},headerTitle:{fontSize:'28px',fontWeight:'bold',color:'#1f2937',margin:0},loadingText:{fontSize:'16px',fontWeight:'normal',color:'#6b7280'},backButton:{padding:'10px 20px',backgroundColor:'#3b82f6',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontWeight:'600'},errorContainer:{textAlign:'center',padding:'40px',backgroundColor:'white',borderRadius:'12px',boxShadow:'0 4px 12px rgba(0, 0, 0, 0.08)'},loadingContainer:{textAlign:'center',padding:'40px'},emptyState:{textAlign:'center',padding:'40px',backgroundColor:'white',borderRadius:'12px',boxShadow:'0 4px 12px rgba(0, 0, 0, 0.08)'},statSection:{display:'flex',gap:'24px',flexWrap:'wrap',marginBottom:'32px'},controlsSection:{marginBottom:'24px',display:'flex',gap:'16px',flexWrap:'wrap',alignItems:'center'},searchInput:{padding:'10px 12px',border:'1px solid #d1d5db',borderRadius:'8px',flexGrow:1,minWidth:'300px'},filterSelect:{padding:'10px 12px',border:'1px solid #d1d5db',borderRadius:'8px',backgroundColor:'white'},addButton:{padding:'10px 20px',backgroundColor:'#2563eb',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontWeight:'600'},button:{padding:'10px 16px',backgroundColor:'#2563eb',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontWeight:'600'},permissionInfo:{backgroundColor:'#e0f2fe',padding:'12px',borderRadius:'8px',marginTop:'16px',border:'1px solid #0891b2'},tableContainer:{backgroundColor:'white',borderRadius:'8px',boxShadow:'0 4px 6px rgba(0, 0, 0, 0.1)',overflowX:'auto'},table:{width:'100%',borderCollapse:'collapse'},th:{padding:'12px 16px',textAlign:'left',fontSize:'14px',color:'#4b5563',backgroundColor:'#f9fafb',borderBottom:'1px solid #e5e7eb',fontWeight:'600'},td:{padding:'12px 16px',fontSize:'14px',color:'#374151',borderBottom:'1px solid #e5e7eb'},actionButtonEdit:{padding:'4px 8px',fontSize:'12px',fontWeight:'600',color:'white',backgroundColor:'#f59e0b',border:'none',borderRadius:'6px',cursor:'pointer'},actionButtonDelete:{padding:'4px 8px',fontSize:'12px',fontWeight:'600',color:'white',backgroundColor:'#ef4444',border:'none',borderRadius:'6px',cursor:'pointer'},modalOverlay:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.5)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:1000},modalContent:{backgroundColor:'white',padding:'32px',borderRadius:'12px',width:'90%',maxWidth:'500px',boxShadow:'0 8px 16px rgba(0, 0, 0, 0.2)'},modalTitle:{fontSize:'24px',fontWeight:'bold',marginBottom:'24px',color:'#1f2937'},modalForm:{display:'flex',flexDirection:'column',gap:'16px'},modalLabel:{display:'block',marginBottom:'8px',fontWeight:'600',color:'#374151'},modalInput:{width:'100%',padding:'10px',border:'1px solid #d1d5db',borderRadius:'8px',boxSizing:'border-box'},inputError:{borderColor:'#ef4444'},errorMessage:{color:'#ef4444',fontSize:'12px',marginTop:'4px'},formError:{color:'#ef4444',backgroundColor:'#fee2e2',padding:'10px',borderRadius:'8px',textAlign:'center',marginBottom:'16px'},impactPreview:{backgroundColor:'#f0f9ff',padding:'12px',borderRadius:'8px',fontSize:'14px'},modalActions:{display:'flex',justifyContent:'flex-end',gap:'12px',marginTop:'32px'},modalButtonCancel:{padding:'10px 20px',backgroundColor:'#6b7280',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontWeight:'600'},modalButtonSave:{padding:'10px 20px',backgroundColor:'#2563eb',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontWeight:'600'}};export default Contributions;","map":{"version":3,"names":["React","useState","useEffect","useMemo","useAuth","useNavigate","jsx","_jsx","jsxs","_jsxs","MINIMUM_CONTRIBUTION","CONTRIBUTION_DUE_DAY","LATE_FEE_PER_DAY","BONUS_THRESHOLD","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","Contributions","user","hasPermission","getRoleDisplayName","navigate","contributions","setContributions","members","setMembers","loading","setLoading","error","setError","filteredContributions","setFilteredContributions","searchTerm","setSearchTerm","filterStatus","setFilterStatus","isModalOpen","setIsModalOpen","isSubmitting","setIsSubmitting","initialFormState","member","amount","date","Date","toISOString","split","currentContribution","setCurrentContribution","editingContribution","setEditingContribution","formErrors","setFormErrors","fetchContributions","response","fetch","headers","token","ok","Error","status","data","json","err","message","console","fetchMembers","currentData","filter","c","find","m","id","memberName","first_name","last_name","toLowerCase","includes","toString","is_late","stats","totalContributions","length","totalLate","currentMonthTotal","cDate","today","getMonth","getFullYear","reduce","sum","totalAmount","selectedMemberInModal","calculateContributionImpact","contributionDate","dayOfMonth","getDate","isLate","hasBonus70","pointsChange","penalties","daysLate","handleOpenModalForAdd","alert","handleOpenModalForEdit","contribution","handleDelete","window","confirm","method","errorData","catch","detail","statusText","errorMessage","handleSave","general","toLocaleString","url","body","JSON","stringify","closeModal","canViewStats","canAddContributions","canEditContributions","canDeleteContributions","style","styles","page","children","errorContainer","role","onClick","button","impact","header","headerTitle","loadingText","backButton","statSection","StatCard","title","value","controlsSection","type","placeholder","onChange","e","target","searchInput","filterSelect","addButton","loadingContainer","emptyState","tableContainer","table","th","map","td","toLocaleDateString","StatusChip","color","points_berry","fontWeight","display","gap","actionButtonEdit","actionButtonDelete","permissionInfo","modalOverlay","modalContent","modalTitle","formError","modalForm","modalLabel","modalInput","parseInt","disabled","fontSize","marginTop","berry_score","ModalInput","label","parseFloat","impactPreview","modalActions","modalButtonCancel","modalButtonSave","_ref","props","inputError","_ref2","backgroundColor","padding","borderRadius","boxShadow","flex","textAlign","margin","_ref3","chipStyle","fontFamily","minHeight","justifyContent","alignItems","marginBottom","flexWrap","border","cursor","flexGrow","minWidth","overflowX","width","borderCollapse","borderBottom","position","top","left","right","bottom","zIndex","maxWidth","flexDirection","boxSizing","borderColor"],"sources":["D:/Projects/FriendlyBanks/frontend/src/components/Contributions.tsx"],"sourcesContent":["// src/components/Contributions.tsx - VERSION CONNECTÉE À L'API DJANGO\r\n\r\nimport React, { useState, useEffect, useMemo, ChangeEvent, InputHTMLAttributes, SelectHTMLAttributes, ReactNode } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\n// --- INTERFACES ADAPTÉES À L'API DJANGO ---\r\ninterface ApiContribution {\r\n  id: number;\r\n  member: number; // ID du membre\r\n  amount: number;\r\n  date: string;\r\n  is_late: boolean;\r\n  points_berry: number;\r\n}\r\n\r\ninterface ApiMember {\r\n  id: number;\r\n  user: {\r\n    id: number;\r\n    username: string;\r\n    email: string;\r\n    first_name: string;\r\n    last_name: string;\r\n    role: string;\r\n  };\r\n  berry_score: number;\r\n  shares: number;\r\n}\r\n\r\n// Interface pour le formulaire\r\ninterface ContributionFormData {\r\n  member: number;\r\n  amount: number;\r\n  date: string;\r\n}\r\n\r\nconst MINIMUM_CONTRIBUTION = 4000;\r\nconst CONTRIBUTION_DUE_DAY = 25;\r\nconst LATE_FEE_PER_DAY = 200;\r\nconst BONUS_THRESHOLD = 6800; // 4000 + 70% de 4000\r\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://127.0.0.1:8000/api';\r\n\r\n// --- COMPOSANT PRINCIPAL ---\r\nconst Contributions: React.FC = () => {\r\n  const { user, hasPermission, getRoleDisplayName } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  // --- ÉTATS ---\r\n  const [contributions, setContributions] = useState<ApiContribution[]>([]);\r\n  const [members, setMembers] = useState<ApiMember[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [filteredContributions, setFilteredContributions] = useState<ApiContribution[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterStatus, setFilterStatus] = useState('All');\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  const initialFormState: ContributionFormData = {\r\n    member: 0,\r\n    amount: MINIMUM_CONTRIBUTION,\r\n    date: new Date().toISOString().split('T')[0],\r\n  };\r\n  \r\n  const [currentContribution, setCurrentContribution] = useState(initialFormState);\r\n  const [editingContribution, setEditingContribution] = useState<ApiContribution | null>(null);\r\n  const [formErrors, setFormErrors] = useState<{ [key: string]: string }>({});\r\n\r\n  // --- FONCTIONS API ---\r\n  const fetchContributions = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await fetch(`${API_BASE_URL}/contributions/`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${user?.token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Erreur HTTP: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      setContributions(data);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Erreur lors du chargement des contributions');\r\n      console.error('Erreur lors du chargement des contributions:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchMembers = async () => {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/members/`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${user?.token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Erreur HTTP: ${response.status}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n      setMembers(data);\r\n    } catch (err) {\r\n      console.error('Erreur lors du chargement des membres:', err);\r\n    }\r\n  };\r\n\r\n  // Charger les données au montage du composant\r\n  useEffect(() => {\r\n    if (user?.token) {\r\n      fetchContributions();\r\n      fetchMembers();\r\n    }\r\n  }, [user?.token]);\r\n\r\n  // --- FILTRAGE DES CONTRIBUTIONS ---\r\n  useEffect(() => {\r\n    let currentData = contributions;\r\n    \r\n    if (searchTerm) {\r\n      currentData = currentData.filter(c => {\r\n        const member = members.find(m => m.id === c.member);\r\n        const memberName = member ? `${member.user.first_name} ${member.user.last_name}` : '';\r\n        return memberName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n               c.id.toString().includes(searchTerm.toLowerCase());\r\n      });\r\n    }\r\n    \r\n    if (filterStatus !== 'All') {\r\n      currentData = currentData.filter(c => {\r\n        if (filterStatus === 'En retard') return c.is_late;\r\n        if (filterStatus === 'À temps') return !c.is_late;\r\n        return true;\r\n      });\r\n    }\r\n    \r\n    setFilteredContributions(currentData);\r\n  }, [searchTerm, filterStatus, contributions, members]);\r\n\r\n  // --- CALCULS MEMOIZÉS ---\r\n  const stats = useMemo(() => ({\r\n    totalContributions: contributions.length,\r\n    totalLate: contributions.filter(c => c.is_late).length,\r\n    currentMonthTotal: contributions.filter(c => {\r\n      const cDate = new Date(c.date);\r\n      const today = new Date();\r\n      return cDate.getMonth() === today.getMonth() && cDate.getFullYear() === today.getFullYear();\r\n    }).reduce((sum, c) => sum + c.amount, 0),\r\n    totalAmount: contributions.reduce((sum, c) => sum + c.amount, 0),\r\n  }), [contributions]);\r\n\r\n  const selectedMemberInModal = useMemo(() => {\r\n    return members.find(m => m.id === currentContribution.member);\r\n  }, [currentContribution.member, members]);\r\n\r\n  // --- FONCTIONS UTILITAIRES ---\r\n  const calculateContributionImpact = (amount: number, date: string) => {\r\n    const contributionDate = new Date(date);\r\n    const dayOfMonth = contributionDate.getDate();\r\n    const isLate = dayOfMonth > CONTRIBUTION_DUE_DAY;\r\n    const hasBonus70 = amount >= BONUS_THRESHOLD;\r\n    \r\n    let pointsChange = 0;\r\n    let penalties = 0;\r\n    \r\n    if (isLate) {\r\n      pointsChange -= 15; // Pénalité retard selon la charte\r\n      const daysLate = dayOfMonth - CONTRIBUTION_DUE_DAY;\r\n      penalties = daysLate * LATE_FEE_PER_DAY;\r\n    } else {\r\n      pointsChange += 5; // Points base pour contribution à temps\r\n    }\r\n    \r\n    if (hasBonus70) {\r\n      pointsChange += 5; // Bonus 70%\r\n    }\r\n    \r\n    return { pointsChange, penalties, isLate, hasBonus70 };\r\n  };\r\n\r\n  // --- GESTIONNAIRES D'ÉVÉNEMENTS ---\r\n  const handleOpenModalForAdd = () => {\r\n    if (!hasPermission('add_contributions') && !hasPermission('manage_contributions')) {\r\n      alert(\"Vous n'avez pas la permission d'ajouter des contributions.\");\r\n      return;\r\n    }\r\n\r\n    setEditingContribution(null);\r\n    setCurrentContribution(initialFormState);\r\n    setFormErrors({});\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleOpenModalForEdit = (contribution: ApiContribution) => {\r\n    if (!hasPermission('edit_contributions') && !hasPermission('manage_contributions')) {\r\n      alert(\"Vous n'avez pas la permission de modifier les contributions.\");\r\n      return;\r\n    }\r\n\r\n    setEditingContribution(contribution);\r\n    setCurrentContribution({\r\n      member: contribution.member,\r\n      amount: contribution.amount,\r\n      date: contribution.date,\r\n    });\r\n    setFormErrors({});\r\n    setIsModalOpen(true);\r\n  };\r\n  \r\n  const handleDelete = async (id: number) => {\r\n    if (!hasPermission('manage_contributions')) {\r\n      alert(\"Vous n'avez pas la permission de supprimer des contributions.\");\r\n      return;\r\n    }\r\n\r\n    if (!window.confirm('Êtes-vous sûr de vouloir supprimer cette contribution ?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/contributions/${id}/`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n          'Authorization': `Bearer ${user?.token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (response.status === 404) {\r\n        throw new Error('Contribution non trouvée. Elle a peut-être déjà été supprimée.');\r\n      }\r\n      \r\n      if (response.status === 403) {\r\n        throw new Error('Accès refusé. Vérifiez vos permissions.');\r\n      }\r\n      \r\n      if (response.status === 405) {\r\n        throw new Error('Méthode DELETE non autorisée sur cet endpoint.');\r\n      }\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => null);\r\n        throw new Error(errorData?.detail || errorData?.error || `Erreur HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      await fetchContributions();\r\n      alert('Contribution supprimée avec succès');\r\n      \r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Erreur lors de la suppression';\r\n      setError(errorMessage);\r\n      alert(`Erreur: ${errorMessage}`);\r\n      console.error('Erreur lors de la suppression:', err);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    // Validation\r\n    if (!currentContribution.member || !currentContribution.amount) {\r\n      setFormErrors({ general: 'Veuillez sélectionner un membre et saisir un montant valide.' });\r\n      return;\r\n    }\r\n\r\n    if (currentContribution.amount < MINIMUM_CONTRIBUTION) {\r\n      setFormErrors({ amount: `Le montant minimal est de ${MINIMUM_CONTRIBUTION.toLocaleString()} XAF.` });\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setFormErrors({});\r\n\r\n    try {\r\n      const method = editingContribution ? 'PUT' : 'POST';\r\n      const url = editingContribution \r\n        ? `${API_BASE_URL}/contributions/${editingContribution.id}/`\r\n        : `${API_BASE_URL}/contributions/`;\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          'Authorization': `Bearer ${user?.token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(currentContribution),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || `Erreur lors de ${editingContribution ? 'la modification' : 'la création'}`);\r\n      }\r\n\r\n      await fetchContributions();\r\n      setIsModalOpen(false);\r\n      \r\n      if (editingContribution) {\r\n        alert('Contribution modifiée avec succès !');\r\n      } else {\r\n        alert('Contribution ajoutée avec succès !');\r\n      }\r\n      \r\n    } catch (err) {\r\n      setFormErrors({ \r\n        general: err instanceof Error ? err.message : 'Erreur lors de la sauvegarde' \r\n      });\r\n      console.error('Erreur lors de la sauvegarde:', err);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setIsModalOpen(false);\r\n    setEditingContribution(null);\r\n    setFormErrors({});\r\n    setIsSubmitting(false);\r\n  };\r\n\r\n  // --- PERMISSIONS D'AFFICHAGE ---\r\n  const canViewStats = hasPermission('view_reports') || hasPermission('manage_contributions');\r\n  const canAddContributions = hasPermission('add_contributions') || hasPermission('manage_contributions');\r\n  const canEditContributions = hasPermission('edit_contributions') || hasPermission('manage_contributions');\r\n  const canDeleteContributions = hasPermission('manage_contributions');\r\n\r\n  // --- VÉRIFICATION DES PERMISSIONS ---\r\n  if (!hasPermission('view_contributions')) {\r\n    return (\r\n      <div style={styles.page}>\r\n        <div style={styles.errorContainer}>\r\n          <h3>Accès refusé</h3>\r\n          <p>Vous n'avez pas la permission de consulter les contributions.</p>\r\n          <p>Votre rôle actuel : <strong>{user?.role ? getRoleDisplayName(user.role as any) : 'Non défini'}</strong></p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // --- AFFICHAGE DE L'ERREUR ---\r\n  if (error && !loading) {\r\n    return (\r\n      <div style={styles.page}>\r\n        <div style={styles.errorContainer}>\r\n          <h3>Erreur de chargement</h3>\r\n          <p>{error}</p>\r\n          <button onClick={fetchContributions} style={styles.button}>\r\n            Réessayer\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Calcul de l'impact pour l'aperçu\r\n  const impact = currentContribution.amount >= MINIMUM_CONTRIBUTION && currentContribution.date \r\n    ? calculateContributionImpact(currentContribution.amount, currentContribution.date)\r\n    : null;\r\n\r\n  // --- RENDU PRINCIPAL ---\r\n  return (\r\n    <div style={styles.page}>\r\n      <header style={styles.header}>\r\n        <h2 style={styles.headerTitle}>\r\n          Gestion des Contributions\r\n          {loading && <span style={styles.loadingText}> (Chargement...)</span>}\r\n        </h2>\r\n        <button onClick={() => navigate('/')} style={styles.backButton}>\r\n          ← Retour au Tableau de bord\r\n        </button>\r\n      </header>\r\n\r\n      {canViewStats && (\r\n        <section style={styles.statSection}>\r\n          <StatCard title=\"Total ce mois\" value={`${stats.currentMonthTotal.toLocaleString()} XAF`} />\r\n          <StatCard title=\"Total contributions\" value={stats.totalContributions.toString()} />\r\n          <StatCard title=\"Contributions en retard\" value={stats.totalLate.toString()} />\r\n          <StatCard title=\"Montant total\" value={`${stats.totalAmount.toLocaleString()} XAF`} />\r\n        </section>\r\n      )}\r\n\r\n      <section style={styles.controlsSection}>\r\n        <input \r\n          type=\"text\" \r\n          placeholder=\"Rechercher par nom, ID...\" \r\n          value={searchTerm} \r\n          onChange={(e) => setSearchTerm(e.target.value)} \r\n          style={styles.searchInput} \r\n        />\r\n        <select \r\n          value={filterStatus} \r\n          onChange={(e) => setFilterStatus(e.target.value)} \r\n          style={styles.filterSelect}\r\n        >\r\n          <option value=\"All\">Tous les statuts</option>\r\n          <option value=\"À temps\">À temps</option>\r\n          <option value=\"En retard\">En retard</option>\r\n        </select>\r\n        \r\n        {canAddContributions && (\r\n          <button onClick={handleOpenModalForAdd} style={styles.addButton}>\r\n            + Ajouter une Cotisation\r\n          </button>\r\n        )}\r\n      </section>\r\n\r\n      {loading ? (\r\n        <div style={styles.loadingContainer}>\r\n          <p>Chargement des contributions...</p>\r\n        </div>\r\n      ) : filteredContributions.length === 0 ? (\r\n        <div style={styles.emptyState}>\r\n          <p>Aucune contribution trouvée.</p>\r\n          {contributions.length === 0 && (\r\n            <p>Commencez par ajouter votre première contribution !</p>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div style={styles.tableContainer}>\r\n          <table style={styles.table}>\r\n            <thead>\r\n              <tr>\r\n                <th style={styles.th}>ID</th>\r\n                <th style={styles.th}>Membre</th>\r\n                <th style={styles.th}>Montant</th>\r\n                <th style={styles.th}>Date</th>\r\n                <th style={styles.th}>Statut</th>\r\n                {canViewStats && <th style={styles.th}>Points Berry</th>}\r\n                {(canEditContributions || canDeleteContributions) && <th style={styles.th}>Actions</th>}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filteredContributions.map((c) => {\r\n                const member = members.find(m => m.id === c.member);\r\n                const memberName = member ? `${member.user.first_name} ${member.user.last_name}` : 'Membre inconnu';\r\n                \r\n                return (\r\n                  <tr key={c.id}>\r\n                    <td style={styles.td}>{c.id}</td>\r\n                    <td style={styles.td}>{memberName}</td>\r\n                    <td style={styles.td}>{c.amount.toLocaleString()} XAF</td>\r\n                    <td style={styles.td}>{new Date(c.date).toLocaleDateString('fr-FR')}</td>\r\n                    <td style={styles.td}>\r\n                      <StatusChip status={c.is_late ? 'En retard' : 'À temps'} />\r\n                    </td>\r\n                    {canViewStats && (\r\n                      <td style={styles.td}>\r\n                        <span style={{ \r\n                          color: c.points_berry > 0 ? '#22c55e' : '#ef4444', \r\n                          fontWeight: 'bold' \r\n                        }}>\r\n                          {c.points_berry > 0 ? `+${c.points_berry}` : c.points_berry} pts\r\n                        </span>\r\n                      </td>\r\n                    )}\r\n                    {(canEditContributions || canDeleteContributions) && (\r\n                      <td style={{...styles.td, display: 'flex', gap: '8px' }}>\r\n                        {canEditContributions && (\r\n                          <button \r\n                            onClick={() => handleOpenModalForEdit(c)} \r\n                            style={styles.actionButtonEdit}\r\n                          >\r\n                            Modifier\r\n                          </button>\r\n                        )}\r\n                        {canDeleteContributions && (\r\n                          <button \r\n                            onClick={() => handleDelete(c.id)} \r\n                            style={styles.actionButtonDelete}\r\n                          >\r\n                            Supprimer\r\n                          </button>\r\n                        )}\r\n                      </td>\r\n                    )}\r\n                  </tr>\r\n                );\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      {/* Informations sur les permissions pour les membres */}\r\n      {!canAddContributions && !canEditContributions && (\r\n        <div style={styles.permissionInfo}>\r\n          <p>\r\n            <strong>Information :</strong> En tant que {user?.role ? getRoleDisplayName(user.role as any) : 'membre'}, \r\n            vous pouvez consulter les contributions mais pas les modifier. \r\n            Contactez le Trésorier pour toute modification.\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {isModalOpen && (\r\n        <div style={styles.modalOverlay}>\r\n          <div style={styles.modalContent}>\r\n            <h3 style={styles.modalTitle}>\r\n              {editingContribution ? 'Modifier la Contribution' : 'Ajouter une Contribution'}\r\n            </h3>\r\n            {formErrors.general && <p style={styles.formError}>{formErrors.general}</p>}\r\n            \r\n            <div style={styles.modalForm}>\r\n              <div>\r\n                <label style={styles.modalLabel}>Membre</label>\r\n                <select\r\n                  style={styles.modalInput}\r\n                  value={currentContribution.member}\r\n                  onChange={e => setCurrentContribution({\r\n                    ...currentContribution, \r\n                    member: parseInt(e.target.value)\r\n                  })}\r\n                  disabled={isSubmitting}\r\n                >\r\n                  <option value={0} disabled>Sélectionner un membre...</option>\r\n                  {members.map(m => \r\n                    <option key={m.id} value={m.id}>\r\n                      {m.user.first_name} {m.user.last_name}\r\n                    </option>\r\n                  )}\r\n                </select>\r\n                {selectedMemberInModal && (\r\n                  <p style={{fontSize: '12px', color: '#1e3a8a', marginTop: '4px'}}>\r\n                    Solde actuel: {selectedMemberInModal.berry_score} points Berry\r\n                  </p>\r\n                )}\r\n                {formErrors.member && <p style={styles.errorMessage}>{formErrors.member}</p>}\r\n              </div>\r\n              \r\n              <ModalInput \r\n                label={`Montant (XAF) - Minimum: ${MINIMUM_CONTRIBUTION.toLocaleString()}`}\r\n                type=\"number\" \r\n                value={currentContribution.amount} \r\n                onChange={e => setCurrentContribution({\r\n                  ...currentContribution, \r\n                  amount: parseFloat(e.target.value) || 0\r\n                })}\r\n                error={formErrors.amount}\r\n                disabled={isSubmitting}\r\n              />\r\n              \r\n              <ModalInput \r\n                label=\"Date\" \r\n                type=\"date\" \r\n                value={currentContribution.date} \r\n                onChange={e => setCurrentContribution({\r\n                  ...currentContribution, \r\n                  date: e.target.value\r\n                })}\r\n                error={formErrors.date}\r\n                disabled={isSubmitting}\r\n              />\r\n\r\n              {/* Aperçu de l'impact selon la charte */}\r\n              {impact && (\r\n                <div style={styles.impactPreview}>\r\n                  <h4>Aperçu de l'impact (selon la charte) :</h4>\r\n                  <ul>\r\n                    {!impact.isLate && (\r\n                      <li style={{color: '#22c55e'}}>Points Berry de base : +5 points (contribution à temps)</li>\r\n                    )}\r\n                    {impact.hasBonus70 && (\r\n                      <li style={{color: '#22c55e'}}>Bonus 70% : +5 points (montant {'>'}= {BONUS_THRESHOLD.toLocaleString()} XAF)</li>\r\n                    )}\r\n                    {impact.isLate && (\r\n                      <li style={{color: '#ef4444'}}>\r\n                        Retard : -15 points Berry\r\n                        {impact.penalties > 0 && ` + ${impact.penalties.toLocaleString()} XAF d'amende`}\r\n                      </li>\r\n                    )}\r\n                    <li style={{color: impact.pointsChange > 0 ? '#22c55e' : '#ef4444', fontWeight: 'bold'}}>\r\n                      Total impact : {impact.pointsChange > 0 ? '+' : ''}{impact.pointsChange} points Berry\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div style={styles.modalActions}>\r\n              <button \r\n                onClick={closeModal} \r\n                style={styles.modalButtonCancel}\r\n                disabled={isSubmitting}\r\n              >\r\n                Annuler\r\n              </button>\r\n              <button \r\n                onClick={handleSave} \r\n                style={styles.modalButtonSave}\r\n                disabled={isSubmitting}\r\n              >\r\n                {isSubmitting ? \r\n                  (editingContribution ? 'Modification...' : 'Ajout...') : \r\n                  (editingContribution ? 'Enregistrer' : 'Ajouter')\r\n                }\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- COMPOSANTS D'ASSISTANCE ---\r\ninterface ModalInputProps extends InputHTMLAttributes<HTMLInputElement> { \r\n  label: string; \r\n  error?: string;\r\n}\r\nconst ModalInput: React.FC<ModalInputProps> = ({ label, error, ...props }) => (\r\n  <div>\r\n    <label style={styles.modalLabel}>{label}</label>\r\n    <input style={{...styles.modalInput, ...(error && styles.inputError)}} {...props} />\r\n    {error && <p style={styles.errorMessage}>{error}</p>}\r\n  </div>\r\n);\r\n\r\nconst StatCard: React.FC<{ title: string; value: string }> = ({ title, value }) => (\r\n  <div style={{ \r\n    backgroundColor: 'white', \r\n    padding: '20px', \r\n    borderRadius: '8px', \r\n    boxShadow: '0 4px 6px rgba(0,0,0,0.1)', \r\n    flex: '1 1 250px', \r\n    textAlign: 'center' \r\n  }}>\r\n    <h4 style={{ margin: 0, color: '#4b5563', fontSize: '16px', fontWeight: '600' }}>\r\n      {title}\r\n    </h4>\r\n    <p style={{ margin: '8px 0 0 0', color: '#1e3a8a', fontSize: '28px', fontWeight: 'bold' }}>\r\n      {value}\r\n    </p>\r\n  </div>\r\n);\r\n\r\nconst StatusChip: React.FC<{ status: string }> = ({ status }) => {\r\n  const chipStyle: React.CSSProperties = {\r\n    padding: '4px 12px', \r\n    borderRadius: '9999px', \r\n    fontWeight: '600', \r\n    fontSize: '12px', \r\n    color: 'white',\r\n    backgroundColor: status === 'À temps' ? '#22c55e' : '#ef4444'\r\n  };\r\n  return <span style={chipStyle}>{status}</span>;\r\n};\r\n\r\n// --- STYLES ---\r\nconst styles: { [key: string]: React.CSSProperties } = {\r\n  page: { fontFamily: 'Arial, sans-serif', padding: '24px', backgroundColor: '#f3f4f6', minHeight: '100vh' },\r\n  header: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '32px', flexWrap: 'wrap', gap: '16px' },\r\n  headerTitle: { fontSize: '28px', fontWeight: 'bold', color: '#1f2937', margin: 0 },\r\n  loadingText: { fontSize: '16px', fontWeight: 'normal', color: '#6b7280' },\r\n  backButton: { padding: '10px 20px', backgroundColor: '#3b82f6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600' },\r\n  errorContainer: { textAlign: 'center', padding: '40px', backgroundColor: 'white', borderRadius: '12px', boxShadow: '0 4px 12px rgba(0, 0, 0, 0.08)' },\r\n  loadingContainer: { textAlign: 'center', padding: '40px' },\r\n  emptyState: { textAlign: 'center', padding: '40px', backgroundColor: 'white', borderRadius: '12px', boxShadow: '0 4px 12px rgba(0, 0, 0, 0.08)' },\r\n  statSection: { display: 'flex', gap: '24px', flexWrap: 'wrap', marginBottom: '32px' },\r\n  controlsSection: { marginBottom: '24px', display: 'flex', gap: '16px', flexWrap: 'wrap', alignItems: 'center' },\r\n  searchInput: { padding: '10px 12px', border: '1px solid #d1d5db', borderRadius: '8px', flexGrow: 1, minWidth: '300px' },\r\n  filterSelect: { padding: '10px 12px', border: '1px solid #d1d5db', borderRadius: '8px', backgroundColor: 'white' },\r\n  addButton: { padding: '10px 20px', backgroundColor: '#2563eb', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600' },\r\n  button: { padding: '10px 16px', backgroundColor: '#2563eb', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600' },\r\n  permissionInfo: { backgroundColor: '#e0f2fe', padding: '12px', borderRadius: '8px', marginTop: '16px', border: '1px solid #0891b2' },\r\n  tableContainer: { backgroundColor: 'white', borderRadius: '8px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)', overflowX: 'auto' },\r\n  table: { width: '100%', borderCollapse: 'collapse' },\r\n  th: { padding: '12px 16px', textAlign: 'left', fontSize: '14px', color: '#4b5563', backgroundColor: '#f9fafb', borderBottom: '1px solid #e5e7eb', fontWeight: '600' },\r\n  td: { padding: '12px 16px', fontSize: '14px', color: '#374151', borderBottom: '1px solid #e5e7eb' },\r\n  actionButtonEdit: { padding: '4px 8px', fontSize: '12px', fontWeight: '600', color: 'white', backgroundColor: '#f59e0b', border: 'none', borderRadius: '6px', cursor: 'pointer' },\r\n  actionButtonDelete: { padding: '4px 8px', fontSize: '12px', fontWeight: '600', color: 'white', backgroundColor: '#ef4444', border: 'none', borderRadius: '6px', cursor: 'pointer' },\r\n  modalOverlay: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 1000 },\r\n  modalContent: { backgroundColor: 'white', padding: '32px', borderRadius: '12px', width: '90%', maxWidth: '500px', boxShadow: '0 8px 16px rgba(0, 0, 0, 0.2)' },\r\n  modalTitle: { fontSize: '24px', fontWeight: 'bold', marginBottom: '24px', color: '#1f2937' },\r\n  modalForm: { display: 'flex', flexDirection: 'column', gap: '16px' },\r\n  modalLabel: { display: 'block', marginBottom: '8px', fontWeight: '600', color: '#374151' },\r\n  modalInput: { width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '8px', boxSizing: 'border-box' },\r\n  inputError: { borderColor: '#ef4444' },\r\n  errorMessage: { color: '#ef4444', fontSize: '12px', marginTop: '4px' },\r\n  formError: { color: '#ef4444', backgroundColor: '#fee2e2', padding: '10px', borderRadius: '8px', textAlign: 'center', marginBottom: '16px' },\r\n  impactPreview: { backgroundColor: '#f0f9ff', padding: '12px', borderRadius: '8px', fontSize: '14px' },\r\n  modalActions: { display: 'flex', justifyContent: 'flex-end', gap: '12px', marginTop: '32px' },\r\n  modalButtonCancel: { padding: '10px 20px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600' },\r\n  modalButtonSave: { padding: '10px 20px', backgroundColor: '#2563eb', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600' },\r\n};\r\n\r\nexport default Contributions;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}